<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 3.14.0"/><link as="script" rel="preload" href="/DemoGatsby/webpack-runtime-4fdd00d27d183d75dcd4.js"/><link as="script" rel="preload" href="/DemoGatsby/framework-33b76a5d919ecf8a8684.js"/><link as="script" rel="preload" href="/DemoGatsby/app-444659934cb01ee83c7c.js"/><link as="script" rel="preload" href="/DemoGatsby/5b193f6accaeb9908c3d71638f39c22a959f684d-91cf4c8dc2f322fa6180.js"/><link as="script" rel="preload" href="/DemoGatsby/component---src-pages-deepdive-gatsby-apicalls-node-creating-pages-js-9a1badda2b85402299ec.js"/><link as="fetch" rel="preload" href="/DemoGatsby/page-data/deepdive/gatsby/apicalls/node/creating-pages/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/DemoGatsby/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><main><title>Creating pages</title><p>See here for where <a href="https://github.com/gatsbyjs/gatsby/blob/17a3f9f69ae2710f4aeef27603226281f2713281/packages/gatsby/src/bootstrap/index.ts#L68" rel="noreferrer" target="_blank">createPages</a> lies in the bootstrapping process</p><p>The <a href="https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/services/create-pages.ts#L47" rel="noreferrer" target="_blank">createPages</a> node api is run first then the <linkNewTab href="https://github.com/gatsbyjs/gatsby/blob/17a3f9f69ae2710f4aeef27603226281f2713281/packages/gatsby/src/services/create-pages.ts#L65" title="createPageStatefully"></linkNewTab> api</p><p>Both functions are passed the same additional argument graphQl.  The difference between the two functions as explained from the <a href="https://www.gatsbyjs.com/docs/reference/config-files/gatsby-node/#createPagesStatefully" rel="noreferrer" target="_blank">docs</a></p><cite>Like createPages but for plugins who want to manage creating and removing pages themselves in response to changes in data not managed by Gatsby. Plugins implementing createPages will get called regularly to recompute page information as Gatsbyâ€™s data changes but those implementing createPagesStatefully will not.</cite><cite>An example of a plugin that uses this extension point is the plugin gatsby-plugin-page-creator which monitors the src/pages directory for the adding and removal of JS pages. As its source of truth, files in the pages directory, is not known by Gatsby, it needs to keep its own state about its world to know when to add and remove pages.</cite><h2>gatsby-plugin-page-creator</h2><p>This plugin is adding if you do not provide it. The docs can be found here <a href="https://www.gatsbyjs.com/plugins/gatsby-plugin-page-creator/" rel="noreferrer" target="_blank">here</a></p><p>If you do not provide the plugin its <a href="https://github.com/gatsbyjs/gatsby/blob/17a3f9f69ae2710f4aeef27603226281f2713281/packages/gatsby/src/bootstrap/load-plugins/load.ts#L353" rel="noreferrer" target="_blank">default options</a> are : </p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-javascript" style="white-space:pre"><span>
</span><span>        </span><span style="color:#408080;font-style:italic">// default options for gatsby-plugin-page-creator</span><span>
</span><span>        </span><span style="color:#954121">let</span><span> pageCreatorOptions: IPluginRefOptions | </span><span style="color:#954121">undefined</span><span> = {
</span><span>            </span><span class="hljs-attr">path</span><span>: slash(path.join(program.directory, </span><span style="color:#219161">`src/pages`</span><span>)),
</span><span>            </span><span class="hljs-attr">pathCheck</span><span>: </span><span style="color:#954121">false</span><span>,
</span>        }
<!-- -->        
</code></pre><h3>How it works</h3><p>For all files with program extensions in the folder specified by the path option consider these files for page creation.</p><p>Program extensions are determined at the begiining of the bootstrap <a href="https://github.com/gatsbyjs/gatsby/blob/492068b0d1a08e544c3c51fb2fc1360087437b99/packages/gatsby/src/services/initialize.ts#L567" rel="noreferrer" target="_blank">services initialize</a></p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-javascript" style="white-space:pre"><span>
</span><span>                </span><span style="color:#408080;font-style:italic">// Collect resolvable extensions and attach to program.</span><span>
</span><span>                </span><span style="color:#954121">const</span><span> extensions = [</span><span style="color:#219161">`.mjs`</span><span>, </span><span style="color:#219161">`.js`</span><span>, </span><span style="color:#219161">`.jsx`</span><span>, </span><span style="color:#219161">`.wasm`</span><span>, </span><span style="color:#219161">`.json`</span><span>]
</span><span>                </span><span style="color:#954121">const</span><span> apiResults = </span><span style="color:#954121">await</span><span> apiRunnerNode(</span><span style="color:#219161">`resolvableExtensions`</span><span>, {
</span><span>                  </span><span class="hljs-attr">traceId</span><span>: </span><span style="color:#219161">`initial-resolvableExtensions`</span><span>,
</span>                  parentSpan,
<!-- -->                })
<!-- -->              
<!-- -->                store.dispatch({
<span>                  </span><span class="hljs-attr">type</span><span>: </span><span style="color:#219161">`SET_PROGRAM_EXTENSIONS`</span><span>,
</span><span>                  </span><span class="hljs-attr">payload</span><span>: _.flattenDeep([extensions, apiResults]),
</span>                })
<!-- -->                
</code></pre><p>These extensions are stored in the redux store <a href="https://github.com/gatsbyjs/gatsby/blob/492068b0d1a08e544c3c51fb2fc1360087437b99/packages/gatsby/src/redux/reducers/program.ts#L30" rel="noreferrer" target="_blank">redux store</a> and the gatsby-plugin-page-creator retrieves them.</p><p><b>The resolvableExtensions node api is important for compile-to-js plugins</b> such as <a href="https://github.com/gatsbyjs/gatsby/blob/492068b0d1a08e544c3c51fb2fc1360087437b99/packages/gatsby-plugin-mdx/gatsby-node.js#L41" rel="noreferrer" target="_blank">gatsby-plugin-mdx</a></p><p>There are 3 ways in which pages can be created:</p><ul><li>Collection pages - path contains <!-- --> </li><li>Client only - path contains []</li><li>Normal page</li></ul><p>For both client and normal page...........</p><p>When the <code>createPage</code> action ( creator ) is invoked a <a href="https://github.com/gatsbyjs/gatsby/blob/7adef559190aa9f785666b1c0ce7f9937230f171/packages/gatsby/src/redux/actions/public.js#L461" rel="noreferrer" target="_blank">SitePage node</a> is also created with details of the page. </p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span>
</span><span>                actions.createPage = </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#00f">
</span><span class="hljs-function" style="color:#00f">                  page: PageInput,
</span><span class="hljs-function" style="color:#00f">                  plugin?: Plugin,
</span><span class="hljs-function" style="color:#00f">                  actionOptions?: ActionOptions
</span><span class="hljs-function" style="color:#00f">                </span><span class="hljs-function">) =&gt;</span><span> {
</span><span>                  </span><span style="color:#954121">const</span><span> internalPage: Page = {
</span>                    internalComponentName,
<span>                    </span><span class="hljs-attr">path</span><span>: page.path,
</span><span>                    </span><span class="hljs-attr">matchPath</span><span>: page.matchPath,
</span><span>                    </span><span class="hljs-attr">component</span><span>: page.component,
</span><span>                    </span><span class="hljs-attr">componentChunkName</span><span>: generateComponentChunkName(page.component),
</span><span>                    </span><span class="hljs-attr">isCreatedByStatefulCreatePages</span><span>:
</span><span>                          actionOptions?.traceId === </span><span style="color:#219161">`initial-createPagesStatefully`</span><span>,
</span><span>                    </span><span style="color:#408080;font-style:italic">// Ensure the page has a context object</span><span>
</span><span>                    </span><span class="hljs-attr">context</span><span>: page.context || {},
</span><span>                    </span><span class="hljs-attr">updatedAt</span><span>: </span><span style="color:#0086b3">Date</span><span>.now(),
</span><span>                    </span><span style="color:#408080;font-style:italic">// Link page to its plugin.</span><span>
</span><span>                    </span><span class="hljs-attr">pluginCreator___NODE</span><span>: plugin.id ?? </span><span style="color:#219161">``</span><span>,
</span><span>                    </span><span class="hljs-attr">pluginCreatorId</span><span>: plugin.id ?? </span><span style="color:#219161">``</span><span>,
</span>                  }
<!-- -->
<span>                  </span><span style="color:#954121">const</span><span> { updatedAt, ...node } = internalPage
</span>                  node.internal = {
<span>                    </span><span class="hljs-attr">type</span><span>: </span><span style="color:#219161">`SitePage`</span><span>,
</span><span>                    </span><span class="hljs-attr">contentDigest</span><span>: createContentDigest(node),
</span>                  }
<!-- -->
<span>                  </span><span style="color:#408080;font-style:italic">// new node path</span><span>
</span>                  node.internal.counter = getNextNodeCounter()
<!-- -->                
<span>                  </span><span style="color:#408080;font-style:italic">// ************************</span><span>
</span><span>                  </span><span style="color:#408080;font-style:italic">// this path taken first time page is encountered</span><span>
</span>                  updateNodeAction = {
<!-- -->                    ...actionOptions,
<span>                    </span><span class="hljs-attr">type</span><span>: </span><span style="color:#219161">`CREATE_NODE`</span><span>,
</span>                    plugin,
<!-- -->                    oldNode,
<span>                    </span><span class="hljs-attr">payload</span><span>: node,
</span>                  }
<span>                  </span><span style="color:#408080;font-style:italic">// *************************</span><span>
</span><span>                  </span><span style="color:#954121">const</span><span> actions = [
</span>                    {
<!-- -->                      ...actionOptions,
<span>                      </span><span class="hljs-attr">type</span><span>: </span><span style="color:#219161">`CREATE_PAGE`</span><span>,
</span>                      contextModified,
<!-- -->                      plugin,
<span>                      </span><span class="hljs-attr">payload</span><span>: internalPage,
</span>                    },
<!-- -->                  ]
<!-- -->                  
<!-- -->                  actions.push(updateNodeAction)
<!-- -->                
<span>                  </span><span style="color:#954121">return</span><span> actions
</span>                }
<!-- -->                
</code></pre><p>Note that as soon as the redux store has been updated with the new page ( the store has been setup to emit ) <a href="https://github.com/gatsbyjs/gatsby/blob/7adef559190aa9f785666b1c0ce7f9937230f171/packages/gatsby/src/redux/plugin-runner.ts#L57" rel="noreferrer" target="_blank">onCreatePage</a> is run.</p><p>The same occurs for the SitePage node.  ( it is only for SitePage nodes as all other nodes are created with the createNode action ( creator ) which deals with this.</p></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/deepdive/gatsby/apicalls/node/creating-pages/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-fd5502421d629d1c910a.js"],"app":["/app-444659934cb01ee83c7c.js"],"component---src-pages-404-js":["/component---src-pages-404-js-da19968e4b00979f9461.js"],"component---src-pages-deepdive-cli-js":["/component---src-pages-deepdive-cli-js-0f18bb1c833ee538d1f1.js"],"component---src-pages-deepdive-gatsby-apicalls-node-creating-nodes-js":["/component---src-pages-deepdive-gatsby-apicalls-node-creating-nodes-js-221ff46555a3e8320634.js"],"component---src-pages-deepdive-gatsby-apicalls-node-creating-pages-js":["/component---src-pages-deepdive-gatsby-apicalls-node-creating-pages-js-9a1badda2b85402299ec.js"],"component---src-pages-deepdive-gatsby-apicalls-node-index-js":["/component---src-pages-deepdive-gatsby-apicalls-node-index-js-75ac4981820e72b02ac7.js"],"component---src-pages-deepdive-gatsby-debugging-js":["/component---src-pages-deepdive-gatsby-debugging-js-289a7563f1d47c52ffac.js"],"component---src-pages-deepdive-gatsby-index-js":["/component---src-pages-deepdive-gatsby-index-js-e7b7db76472828d679e8.js"],"component---src-pages-deepdive-gatsby-plugins-js":["/component---src-pages-deepdive-gatsby-plugins-js-1d2f0cc300cd9a0df475.js"],"component---src-pages-deepdive-mdxplugin-js":["/component---src-pages-deepdive-mdxplugin-js-ff1e0bd02065d047b9bb.js"],"component---src-pages-index-js":["/component---src-pages-index-js-a23928b879e6dd0adc58.js"],"component---src-pages-mdx-mdx":["/component---src-pages-mdx-mdx-a0916c906b3d8eac84ca.js"],"component---src-templates-dynamic-page-template-js":["/component---src-templates-dynamic-page-template-js-5b35e311d2f48f0b9bdd.js"]};/*]]>*/</script><script src="/DemoGatsby/polyfill-fd5502421d629d1c910a.js" nomodule=""></script><script src="/DemoGatsby/component---src-pages-deepdive-gatsby-apicalls-node-creating-pages-js-9a1badda2b85402299ec.js" async=""></script><script src="/DemoGatsby/5b193f6accaeb9908c3d71638f39c22a959f684d-91cf4c8dc2f322fa6180.js" async=""></script><script src="/DemoGatsby/app-444659934cb01ee83c7c.js" async=""></script><script src="/DemoGatsby/framework-33b76a5d919ecf8a8684.js" async=""></script><script src="/DemoGatsby/webpack-runtime-4fdd00d27d183d75dcd4.js" async=""></script></body></html>