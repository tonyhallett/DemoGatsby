<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 3.14.0"/><link as="script" rel="preload" href="/DemoGatsby/webpack-runtime-1bc991e3f6c6760fb2b2.js"/><link as="script" rel="preload" href="/DemoGatsby/framework-33b76a5d919ecf8a8684.js"/><link as="script" rel="preload" href="/DemoGatsby/app-297a04ee365b21fa2188.js"/><link as="script" rel="preload" href="/DemoGatsby/3710c607fb7064fe4fae57fa2457800b9099a42b-828b874f09212eef7e62.js"/><link as="script" rel="preload" href="/DemoGatsby/component---src-pages-deepdive-gatsby-apicalls-node-index-js-25bcd576de4091c3fafe.js"/><link as="fetch" rel="preload" href="/DemoGatsby/page-data/deepdive/gatsby/apicalls/node/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/DemoGatsby/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><main><title>API calls</title><p>The gatsby node api calls can be tracked in source code by looking for <code>apiRunnerNode(</code></p><p>When gatsby needs to run a node api function it is the <a rel="noreferrer" target="_blank">apiRunnerNode</a> that provides the logic.</p><p>Simplifying a little, for all plugins that implement the node function ( with a filter to avoid infinite loop ), gatsby-node.js is <a rel="noreferrer" target="_blank">is required</a> ( and the plugin is cached ).</p><p>The redux actions ( action creators ) that will be made available to the api function are bound which means their return value is automatically dispatched.  If they return a function then that function is passed the dispatch function ( e.g  createNode ).</p><p>From redux ( omitting non essential code ) - <a rel="noreferrer" target="_blank">bindActionCreators</a></p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-javascript" style="white-space:pre"><span>
</span><span>  </span><span style="color:#954121">export</span><span> </span><span style="color:#954121">default</span><span> </span><span class="hljs-function" style="color:#954121">function</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#458;font-weight:bold">bindActionCreators</span><span class="hljs-function">(</span><span class="hljs-function" style="color:#00f">
</span><span class="hljs-function" style="color:#00f">    actionCreators: ActionCreator&lt;any&gt; | ActionCreatorsMapObject,
</span><span class="hljs-function" style="color:#00f">    dispatch: Dispatch
</span><span class="hljs-function" style="color:#00f">  </span><span class="hljs-function">) </span><span>{
</span><span>    </span><span style="color:#954121">if</span><span> (</span><span style="color:#954121">typeof</span><span> actionCreators === </span><span style="color:#219161">&#x27;function&#x27;</span><span>) {
</span><span>      </span><span style="color:#954121">return</span><span> bindActionCreator(actionCreators, dispatch)
</span>    }
<span>    </span><span style="color:#954121">const</span><span> boundActionCreators: ActionCreatorsMapObject = {}
</span><span>    </span><span style="color:#954121">for</span><span> (</span><span style="color:#954121">const</span><span> key </span><span style="color:#954121">in</span><span> actionCreators) {
</span><span>      </span><span style="color:#954121">const</span><span> actionCreator = actionCreators[key]
</span><span>      </span><span style="color:#954121">if</span><span> (</span><span style="color:#954121">typeof</span><span> actionCreator === </span><span style="color:#219161">&#x27;function&#x27;</span><span>) {
</span>        boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)
<!-- -->      }
<!-- -->    }
<span>    </span><span style="color:#954121">return</span><span> boundActionCreators
</span>  }
<!-- -->
<span>  </span><span style="color:#408080;font-style:italic">// redux</span><span>
</span><span>  </span><span class="hljs-function" style="color:#954121">function</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#458;font-weight:bold">bindActionCreator</span><span class="hljs-function">&lt;</span><span class="hljs-function" style="color:#458;font-weight:bold">A</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#458;font-weight:bold">extends</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#458;font-weight:bold">AnyAction</span><span class="hljs-function"> = </span><span class="hljs-function" style="color:#458;font-weight:bold">AnyAction</span><span class="hljs-function">&gt;(</span><span class="hljs-function" style="color:#00f">
</span><span class="hljs-function" style="color:#00f">    actionCreator: ActionCreator&lt;A&gt;,
</span><span class="hljs-function" style="color:#00f">    dispatch: Dispatch
</span><span class="hljs-function" style="color:#00f">  </span><span class="hljs-function">) </span><span>{
</span><span>    </span><span style="color:#954121">return</span><span> </span><span class="hljs-function" style="color:#954121">function</span><span class="hljs-function"> (</span><span class="hljs-function" style="color:#0086b3">this</span><span class="hljs-function" style="color:#00f">: any, ...args: any[]</span><span class="hljs-function">) </span><span>{
</span><span>      </span><span style="color:#954121">return</span><span> dispatch(actionCreator.apply(</span><span style="color:#0086b3">this</span><span>, args))
</span>    }
<!-- -->  }
<!-- -->  
</code></pre><p>It is redux-thunk that provides action functions - <a rel="noreferrer" target="_blank">see</a> </p><p>Then the bound action creators are then double bound.  The action creators can take 1-3 arguments.  The  third argument is not provided by the caller but is the same <b>api specific</b> &quot;arguments&quot; object that the api function will receive as its first argument. If an action creator takes two arguments then the second argument is a plugin argument.  If you do not specify then the plugin is the plugin being run.  From the code comments this functionality is limited and you would need to understand each action.</p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-javascript" style="white-space:pre"><span>
</span><span>          doubleBoundActionCreators[key] = </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#00f">...args</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>            </span><span style="color:#408080;font-style:italic">// Let action callers override who the plugin is. Shouldn&#x27;t be</span><span>
</span><span>            </span><span style="color:#408080;font-style:italic">// used that often.</span><span>
</span><span>            </span><span style="color:#954121">if</span><span> (args.length === </span><span style="color:#40a070">1</span><span>) {
</span><span>              </span><span style="color:#954121">return</span><span> boundActionCreator(args[</span><span style="color:#40a070">0</span><span>], plugin, actionOptions)
</span><span>            } </span><span style="color:#954121">else</span><span> </span><span style="color:#954121">if</span><span> (args.length === </span><span style="color:#40a070">2</span><span>) {
</span><span>              </span><span style="color:#954121">return</span><span> boundActionCreator(args[</span><span style="color:#40a070">0</span><span>], args[</span><span style="color:#40a070">1</span><span>], actionOptions)
</span>            }
<span>            </span><span style="color:#954121">return</span><span> </span><span style="color:#954121">undefined</span><span>
</span>          }
<!-- -->  
</code></pre><p>Then the node api function is invoked with two arguments.  The first argument is an object with fields that are common for all api functions and ones that are particular to it <a rel="noreferrer" target="_blank">fields that are common for all api functions and ones that are particular to it</a>.  The second argument is the plugin&#x27;s options from the gatsby config.</p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-javascript" style="white-space:pre"><span>
</span><span>     </span><span style="color:#0086b3">module</span><span>.exports = {
</span><span>      </span><span class="hljs-attr">plugins</span><span>: [
</span>        {
<span>          </span><span class="hljs-attr">resolve</span><span>: </span><span style="color:#219161">&quot;a-plugin&quot;</span><span>,
</span><span>          </span><span class="hljs-attr">options</span><span>: {
</span><span>            </span><span class="hljs-attr">anOption</span><span>: </span><span style="color:#219161">`some value`</span><span>,
</span>          },
<!-- -->        },
<!-- -->      ],
<!-- -->    }
<!-- -->  
</code></pre><p>A node api function can have as a third argument a callback, of course returning a promise is better.</p><p>The first argument is known as in the docs as <a rel="noreferrer" target="_blank">node api helpers</a>.  These actions are <a href="https://github.com/gatsbyjs/gatsby/blob/c2d42ecc2dccc0862a4a0c796e2db9dec57fcb16/packages/gatsby/src/utils/api-runner-node.js#L273" rel="noreferrer" target="_blank">public or restricted</a>.  Note that the docs are incorrect - there is no exported <code>shadowCreatePagePath</code>.  Although there are helpers that are always available to each gatsby-node.js api function some of these helpers are restricted to being invoked within specific api functions.  The following node helpers should only be called within <code>createSchemaCustomization</code> - <code>createFieldExtension</code>, <code>createTypes</code>, <code>createResolverContext</code>, <code>addThirdPartySchema</code>, <code>printTypeDefinitions</code>.</p><p>These api functions will be invoked but with a <a href="https://github.com/gatsbyjs/gatsby/blob/c2d42ecc2dccc0862a4a0c796e2db9dec57fcb16/packages/gatsby/src/redux/actions/restricted.ts#L424" rel="noreferrer" target="_blank">deprecation warning</a> if invoked in <a href="https://github.com/gatsbyjs/gatsby/blob/c2d42ecc2dccc0862a4a0c796e2db9dec57fcb16/packages/gatsby/src/redux/actions/restricted.ts#L530" rel="noreferrer" target="_blank">other specific api functions</a>.  If called <a href="https://github.com/gatsbyjs/gatsby/blob/c2d42ecc2dccc0862a4a0c796e2db9dec57fcb16/packages/gatsby/src/redux/actions/restricted.ts#L515" rel="noreferrer" target="_blank">within any other function</a>nothing occurs and an <a href="https://github.com/gatsbyjs/gatsby/blob/c2d42ecc2dccc0862a4a0c796e2db9dec57fcb16/packages/gatsby/src/redux/actions/restricted.ts#L444" rel="noreferrer" target="_blank">error is reported</a>.</p><p>The cache node api helper should not be used within <a href="https://github.com/gatsbyjs/gatsby/blob/c2d42ecc2dccc0862a4a0c796e2db9dec57fcb16/packages/gatsby/src/utils/api-runner-node.js#L311" rel="noreferrer" target="_blank">onPreInit</a>.  This will throw an error if its <a href="https://github.com/gatsbyjs/gatsby/blob/c2d42ecc2dccc0862a4a0c796e2db9dec57fcb16/packages/gatsby/src/utils/api-runner-node.js#L241" rel="noreferrer" target="_blank">methods are invoked</a>.</p><p>The actions and node api helpers can be grouped by function.  See the pages for further information</p><p>basePath ( undocumented ) and pathPrefix - <a href="/DemoGatsby/deepdive/gatsby/prefixes">prefixes</a></p><p>schema - <a href="/DemoGatsby/deepdive/gatsby/graphql">graphql</a></p><p><a href="/DemoGatsby/deepdive/gatsby/apicalls/node/pages">page actions</a> - deletePage / createPage / createRedirect / createServerVisitedPage ( think that this is experimental and develop only...)</p><p><a href="/DemoGatsby/build">build actions</a> - setWebpackConfig / replaceWebpackConfig / setBabelOptions / setBabelPlugin / setBabelPreset</p><p><a href="/DemoGatsby/node">Node actions and helpers</a>. Actions deleteNode / touchNode / createNode / createNodeField / createParentChildLink and helpers getNode / getNodeAndSavePathDependency / loadNodeContent / createNodeId</p><p>Tracing api helpers tracing and undocumented parentSpan ( which I think is available on the tracing field ).  I am not covering these but for further information see <a href="https://www.gatsbyjs.com/docs/reference/config-files/node-api-helpers/#tracing" rel="noreferrer" target="_blank">docs</a>, <a href="https://www.npmjs.com/package/opentracing" rel="noreferrer" target="_blank">npm - open tracing</a> and <a href="https://github.com/opentracing/specification/blob/master/specification.md" rel="noreferrer" target="_blank">specification</a>.</p><p><a href="https://www.gatsbyjs.com/docs/reference/config-files/actions/#createJobV2" rel="noreferrer" target="_blank">createJobV2</a> will not be covered.  Note that there are other job actions that have been deprecated in favour of createJobV2.</p><p>Some of these are described as internal such as the emitter and the redux store.  To see the slices available from the store see <a rel="noreferrer" target="_blank">redux reducers folder</a>.</p><p>The emitter emits named events with the emit method.  What this means is that all handlers that have subscribed to the event name will be notified.  It is also possible to subscribe to all events using <a rel="noreferrer" target="_blank">*</a>.</p><p>The emitter emits whenever the <a rel="noreferrer" target="_blank">redux store has been updated</a></p></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/deepdive/gatsby/apicalls/node/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-fd5502421d629d1c910a.js"],"app":["/app-297a04ee365b21fa2188.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9f9fd1d9b60435413e61.js"],"component---src-pages-deepdive-cli-js":["/component---src-pages-deepdive-cli-js-5741b91b6777519321aa.js"],"component---src-pages-deepdive-gatsby-apicalls-node-build-js":["/component---src-pages-deepdive-gatsby-apicalls-node-build-js-e5e4b56ca87f5d0bb4a6.js"],"component---src-pages-deepdive-gatsby-apicalls-node-creating-nodes-js":["/component---src-pages-deepdive-gatsby-apicalls-node-creating-nodes-js-b79bfcf2bc434d369d1d.js"],"component---src-pages-deepdive-gatsby-apicalls-node-creating-pages-js":["/component---src-pages-deepdive-gatsby-apicalls-node-creating-pages-js-2dfb533b04b8d55e2216.js"],"component---src-pages-deepdive-gatsby-apicalls-node-index-js":["/component---src-pages-deepdive-gatsby-apicalls-node-index-js-25bcd576de4091c3fafe.js"],"component---src-pages-deepdive-gatsby-apicalls-node-nodes-js":["/component---src-pages-deepdive-gatsby-apicalls-node-nodes-js-78ea86f5dc156d3e163d.js"],"component---src-pages-deepdive-gatsby-apicalls-node-pages-js":["/component---src-pages-deepdive-gatsby-apicalls-node-pages-js-429f58648a20d576e77a.js"],"component---src-pages-deepdive-gatsby-debugging-js":["/component---src-pages-deepdive-gatsby-debugging-js-d5ef0d64a47152f2106d.js"],"component---src-pages-deepdive-gatsby-index-js":["/component---src-pages-deepdive-gatsby-index-js-e7b7db76472828d679e8.js"],"component---src-pages-deepdive-gatsby-plugins-js":["/component---src-pages-deepdive-gatsby-plugins-js-de83669c3a27e3acecd1.js"],"component---src-pages-deepdive-gatsby-prefixes-js":["/component---src-pages-deepdive-gatsby-prefixes-js-21b67aa42668832d6c37.js"],"component---src-pages-deepdive-gatsby-reporter-js":["/component---src-pages-deepdive-gatsby-reporter-js-75b6f100488f1bc790b2.js"],"component---src-pages-deepdive-gatsby-store-cache-js":["/component---src-pages-deepdive-gatsby-store-cache-js-dbe7ef065c5348ef6a7b.js"],"component---src-pages-deepdive-mdxplugin-js":["/component---src-pages-deepdive-mdxplugin-js-ff1e0bd02065d047b9bb.js"],"component---src-pages-index-js":["/component---src-pages-index-js-c65a6b8256ce98a6a1f4.js"],"component---src-pages-match-js":["/component---src-pages-match-js-862f215237c3f2bdb5bc.js"],"component---src-pages-mdx-mdx":["/component---src-pages-mdx-mdx-a0916c906b3d8eac84ca.js"],"component---src-templates-dynamic-page-template-js":["/component---src-templates-dynamic-page-template-js-5b35e311d2f48f0b9bdd.js"]};/*]]>*/</script><script src="/DemoGatsby/polyfill-fd5502421d629d1c910a.js" nomodule=""></script><script src="/DemoGatsby/component---src-pages-deepdive-gatsby-apicalls-node-index-js-25bcd576de4091c3fafe.js" async=""></script><script src="/DemoGatsby/3710c607fb7064fe4fae57fa2457800b9099a42b-828b874f09212eef7e62.js" async=""></script><script src="/DemoGatsby/app-297a04ee365b21fa2188.js" async=""></script><script src="/DemoGatsby/framework-33b76a5d919ecf8a8684.js" async=""></script><script src="/DemoGatsby/webpack-runtime-1bc991e3f6c6760fb2b2.js" async=""></script></body></html>